# Unity Catalog Configuration
# Table registration and access control for GM Data Analysis

resources:
  # Catalog configuration
  catalogs:
    gm_demo:
      name: "gm_demo"
      comment: "GM Data Analysis - Medallion Architecture"
      properties:
        owner: "data_engineering"
        environment: "production"
  
  # Schema configuration
  schemas:
    gm_test_schema:
      name: "gm_test_schema"
      catalog_name: "gm_demo"
      comment: "Schema for GM test data and medallion architecture tables"
      properties:
        data_classification: "internal"
        project: "gm_analysis"
  
  # Volume configuration
  volumes:
    gm_volume:
      name: "gm_volume"
      catalog_name: "gm_demo"
      schema_name: "gm_test_schema"
      volume_type: "MANAGED"
      comment: "Managed volume for GM raw data files"
  
  # Grants for catalog
  grants:
    # Data Engineering team - Full access
    - principal: "data_engineering"
      privileges:
        - "USE_CATALOG"
        - "USE_SCHEMA"
        - "CREATE_SCHEMA"
        - "CREATE_TABLE"
        - "CREATE_VOLUME"
      securable_type: "CATALOG"
      securable_name: "gm_demo"
    
    # Analytics team - Read access
    - principal: "analytics_team"
      privileges:
        - "USE_CATALOG"
        - "USE_SCHEMA"
        - "SELECT"
      securable_type: "CATALOG"
      securable_name: "gm_demo"
    
    # Schema-level grants
    - principal: "data_engineering"
      privileges:
        - "USE_SCHEMA"
        - "CREATE_TABLE"
        - "CREATE_VOLUME"
        - "MODIFY"
      securable_type: "SCHEMA"
      securable_name: "gm_demo.gm_test_schema"
    
    # Bronze layer - Data Engineering only
    - principal: "data_engineering"
      privileges:
        - "SELECT"
        - "MODIFY"
      securable_type: "TABLE"
      securable_name: "gm_demo.gm_test_schema.bronze_*"
    
    # Silver layer - Data Engineering and Analytics
    - principal: "data_engineering"
      privileges:
        - "SELECT"
        - "MODIFY"
      securable_type: "TABLE"
      securable_name: "gm_demo.gm_test_schema.silver_*"
    
    - principal: "analytics_team"
      privileges:
        - "SELECT"
      securable_type: "TABLE"
      securable_name: "gm_demo.gm_test_schema.silver_*"
    
    # Gold layer - All users read access
    - principal: "data_engineering"
      privileges:
        - "SELECT"
        - "MODIFY"
      securable_type: "TABLE"
      securable_name: "gm_demo.gm_test_schema.gold_*"
    
    - principal: "analytics_team"
      privileges:
        - "SELECT"
      securable_type: "TABLE"
      securable_name: "gm_demo.gm_test_schema.gold_*"
    
    - principal: "business_users"
      privileges:
        - "SELECT"
      securable_type: "TABLE"
      securable_name: "gm_demo.gm_test_schema.gold_*"
  
  # Table properties and tags
  table_tags:
    bronze_tables:
      tables:
        - "gm_demo.gm_test_schema.bronze_gm_data_2023"
      tags:
        layer: "bronze"
        data_classification: "raw"
        retention_policy: "7_years"
        pii_data: "false"
    
    silver_tables:
      tables:
        - "gm_demo.gm_test_schema.silver_gm_data_2023"
      tags:
        layer: "silver"
        data_classification: "cleansed"
        retention_policy: "5_years"
        pii_data: "false"
    
    gold_tables:
      tables:
        - "gm_demo.gm_test_schema.gold_gm_data_2023_daily"
        - "gm_demo.gm_test_schema.gold_gm_data_2023_monthly"
        - "gm_demo.gm_test_schema.gold_gm_data_2023_dimensions"
      tags:
        layer: "gold"
        data_classification: "aggregated"
        retention_policy: "10_years"
        business_critical: "true"
